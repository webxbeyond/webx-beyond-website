---
title: Build Context ও Cache Layers
slug: /docker/build-cache
---

# Build Context ও Cache Layers: ডকার ইমেজ বিল্ডিং-এ দক্ষতা

## প্রস্তাবনা

ডকার ইমেজ তৈরি করার সময় "Build Context" ও "Cache Layers"—এই দুইটি বিষয় অত্যন্ত গুরুত্বপূর্ণ। Google, Netflix, Uber-এর মতো বড় কোম্পানিগুলো তাদের অ্যাপ্লিকেশন দ্রুত ডিপ্লয় ও স্কেল করার জন্য ডকার ইমেজ বিল্ডিং-এ দক্ষতা অর্জন করে। এই লেসনে আমরা দেখব, কীভাবে Build Context ও Cache Layers কাজ করে, কেন এগুলো গুরুত্বপূর্ণ, এবং কীভাবে সঠিকভাবে ব্যবহার করলে ইমেজ বিল্ডিং দ্রুত, ছোট ও দক্ষ হয়।

---

## Build Context: কী, কেন ও কিভাবে?

**Build Context** হচ্ছে সেই ফোল্ডার বা ফাইলসমূহের সমষ্টি, যা ডকার ইমেজ তৈরির সময় Docker Engine-এর কাছে পাঠানো হয়।

- যখন আপনি `docker build .` কমান্ড চালান, তখন `.` (ডট) মানে বর্তমান ফোল্ডার—এটাই Build Context।
- Dockerfile-এ `COPY` বা `ADD` কমান্ড ব্যবহার করলে, Build Context-এর মধ্যে থাকা ফাইলগুলোই কপি করা যায়।

**কেন গুরুত্বপূর্ণ?**
- Build Context বড় হলে ইমেজ বিল্ডিং ধীর হয়, কারণ সব ফাইল Docker Daemon-এ আপলোড হয়।
- অপ্রয়োজনীয় ফাইল (যেমন: node_modules, .git, temp) Build Context-এ থাকলে ইমেজ বড় হয় ও বিল্ড স্লো হয়।

**বাস্তব উদাহরণ:**
- Netflix-এর মতো কোম্পানি তাদের কোডবেসে `.dockerignore` ফাইল ব্যবহার করে অপ্রয়োজনীয় ফাইল Build Context থেকে বাদ দেয়, যাতে বিল্ড দ্রুত হয়।

**সহজ এনালজি:**
- ধরুন, আপনি একটি ব্যাগে ভ্রমণের জন্য জিনিসপত্র নিচ্ছেন। অপ্রয়োজনীয় জিনিস নিলে ব্যাগ ভারী হবে, যাত্রা কষ্টকর হবে। Build Context-ও ঠিক তেমন—শুধু দরকারি ফাইল রাখুন।

**Best Practices:**
- `.dockerignore` ফাইল ব্যবহার করুন (যেমন: `.git`, `node_modules`, `*.log` বাদ দিন)।
- Build Context ছোট রাখুন—শুধু দরকারি সোর্স কোড, কনফিগ, ডিপেন্ডেন্সি।

---

## Cache Layers: ইমেজ বিল্ডিং দ্রুত ও দক্ষ করার কৌশল

ডকার ইমেজ তৈরি হয় "লেয়ার" (Layer) দিয়ে। প্রতিটি Dockerfile-এর কমান্ড (যেমন: `RUN`, `COPY`, `ADD`) একটি নতুন লেয়ার তৈরি করে।

**ক্যাশ কীভাবে কাজ করে?**
- Docker Engine আগের বিল্ডের লেয়ারগুলো ক্যাশে রাখে।
- যদি Dockerfile-এর কোনো কমান্ড, Build Context বা ফাইল পরিবর্তন না হয়, তাহলে আগের ক্যাশড লেয়ার ব্যবহার হয়—এতে বিল্ড দ্রুত হয়।

**বাস্তব উদাহরণ:**
- Google-এর মতো কোম্পানি CI/CD পাইপলাইনে ক্যাশড লেয়ার ব্যবহার করে বিল্ড টাইম কমায়।

**সহজ এনালজি:**
- ধরুন, আপনি বারবার একই রেসিপি রান্না করছেন। কিছু উপাদান আগেই প্রস্তুত থাকলে (ক্যাশ), রান্না দ্রুত হয়।

**ক্যাশ ব্রেক/Invalidation:**
- যদি Dockerfile-এর কোনো লাইন বা Build Context-এর কোনো ফাইল পরিবর্তন হয়, সেই লাইন থেকে পরবর্তী সব লেয়ার নতুনভাবে তৈরি হয়—আগের ক্যাশ আর কাজ করে না।

**Best Practices:**
- কম পরিবর্তনশীল কমান্ড (যেমন: ডিপেন্ডেন্সি ইনস্টল) Dockerfile-এর শুরুতে রাখুন।
- বেশি পরিবর্তনশীল কমান্ড (যেমন: সোর্স কোড কপি) শেষে রাখুন।
- Build Context ছোট রাখলে ক্যাশ ভালোভাবে কাজ করে।

---

## Workflow: Build Context ও Cache Layers ব্যবহার

1. **.dockerignore ফাইল তৈরি করুন:**
    ```bash
    node_modules
    .git
    *.log
    temp/
    ```
2. **Dockerfile লিখুন:**
    ```Dockerfile
    FROM node:18-alpine
    WORKDIR /app
    COPY package.json .
    RUN npm install
    COPY . .
    CMD ["node", "index.js"]
    ```
3. **Build Command চালান:**
    ```bash
    docker build -t myapp .
    ```

**ক্যাশ কিভাবে কাজ করবে?**
- যদি `package.json` না বদলায়, `RUN npm install` লেয়ার ক্যাশড থাকবে।
- যদি সোর্স কোড বদলায়, শুধু `COPY . .` ও পরবর্তী লেয়ার নতুনভাবে তৈরি হবে।

---

## সাধারণ ভুলত্রুটি ও সমাধান

- `.dockerignore` না ব্যবহার করলে Build Context বড় হয়, বিল্ড স্লো ও ইমেজ ভারী হয়।
- Dockerfile-এ সবকিছু একসাথে কপি করলে ক্যাশ ঠিকমতো কাজ করে না।
- Build Context-এর বাইরে থাকা ফাইল Dockerfile-এ কপি করা যায় না।

---

## ইন্ডাস্ট্রি ট্রেন্ড ও সেরা অনুশীলন

- **CI/CD-তে ক্যাশড বিল্ড:** GitHub Actions, GitLab CI-তে বিল্ড ক্যাশ ব্যবহার করে বিল্ড টাইম কমানো হচ্ছে।
- **Slim Context:** বড় কোম্পানিগুলো শুধু দরকারি ফাইল Build Context-এ রাখে।
- **Layer Optimization:** Dockerfile-এ লেয়ার অপ্টিমাইজ করে ইমেজ সাইজ ও বিল্ড টাইম কমানো হচ্ছে।

---

## উপসংহার

Build Context ও Cache Layers—এই দুইটি বিষয় দক্ষভাবে ব্যবহার করলে ডকার ইমেজ বিল্ডিং দ্রুত, ছোট ও স্কেলেবল হয়। বাস্তব সিস্টেম ডিজাইনে এগুলো আত্মবিশ্বাসের সঙ্গে প্রয়োগ করুন—আপনার ডকার ও DevOps দক্ষতা আরও বাড়বে!
